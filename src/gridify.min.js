(function(){angular.module("jj.gridify",[]).directive("gridify",["$timeout",function(k){return{controller:["$scope",function(a){var d;this.lastElementRendered=!1;this.init=function(a){d=a};this.colsNum=0;a.dimSet=!1;a.itemWidth=0;a.gridifiedList=[];this.calculateCols=function(a,b){return Math.floor(a/b)};this.getPrevElementOffset=function(a){var b=d.children().eq(a-this.colsNum);return a<this.colsNum?0:parseInt(b[0].style.top.replace("px",""))+b.outerHeight(!0)};this.firstLoaded=function(c){a.dimSet=
!0;this.colsNum=a.options.columns||this.calculateCols(d.width(),c.width);a.itemWidth=c.width;$(d).css("width",a.itemWidth*this.colsNum)};a.$watch("gridifiedList",function(a,b){k(function(){for(var b=0;b<a.length;b++)a[b].position&&a[b].position()},0)},!0)}],restrict:"AE",link:{pre:function(a,d,c){c=a.$eval(c.gridify);a.options=angular.extend({columns:null,responsive:!0,newItemClass:null,containerId:null,firstElementIsStatic:!1},c||{});a.options.firstElementIsStatic&&d.children().eq(0).css("top",d.children().eq(0).css("top"));
a.staticElementNum=0;a.options.firstElementIsStatic&&(a.staticElementNum=1)},post:function(a,d,c,b){function g(c){b.colsNum=a.options.columns||b.calculateCols($(e).width(),a.itemWidth);$(d).css("width",a.itemWidth*b.colsNum);for(var f=0;f<a.gridifiedList.length;f++){var g=f;c?0==g%b.colsNum&&a.gridifiedList[g].position():a.gridifiedList[g].position()}}b.init(d);if(a.options.responsive||a.options.columns)$(window).on("resize",function(){b.calculateCols($(e).width(),a.itemWidth)!=b.colsNum&&g()});var e=
a.options.containerId?$("#"+a.options.containerId):window;a.$on("gridify.re-render",function(a,b){g(b?b.index:null)})}}}}]).directive("gridifyItem",["$rootScope","$timeout","$window",function(k,a,d){return{require:"^gridify",restrict:"AE",link:{pre:function(c,b,d,e){var h=$(b);d=c.$eval(d.gridifyItem);var f=!1;e.firstLoaded({width:b.outerWidth(!0),height:b.outerHeight(!0)});d.position=function(){c.options.newItemClass&&(!f&&e.lastElementRendered)&&h.addClass(c.options.newItemClass);!f&&(e.lastElementRendered&&
0==c.staticElementNum&&0==c.$index)&&h.css("top",0);a(function(){var a=c.$index;h.css("left",b.outerWidth(!0)*((a+c.staticElementNum)%e.colsNum));h.css("top",e.getPrevElementOffset(a+c.staticElementNum));f=!0},0)};$(b).on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){c.options.newItemClass&&$(b).removeClass(c.options.newItemClass)})},post:function(c,b,d,e){a(function(){c.$last&&(e.lastElementRendered=
!0,k.$broadcast("gridify.list-loaded"))},20)}}}}])})();
