(function(){angular.module("jj.gridify",[]).directive("gridify",["$timeout",function(g){return{controller:["$scope",function(a){var d;this.lastElementRendered=!1;this.init=function(a){d=a};this.colsNum=0;a.dimSet=!1;a.itemWidth=0;a.gridifiedList=[];this.calculateCols=function(a,b){return Math.floor(a/b)};this.getPrevElementOffset=function(a){var b=d.children().eq(a-this.colsNum);return a<this.colsNum?0:parseInt(b[0].style.top.replace("px",""))+b.outerHeight(!0)};this.firstLoaded=function(c){a.dimSet=
!0;this.colsNum=a.options.columns||this.calculateCols(d.width(),c.width);a.itemWidth=c.width;$(d).css("width",a.itemWidth*this.colsNum)};a.$watch("gridifiedList",function(a,b){g(function(){for(var b=0;b<a.length;b++)a[b].position&&a[b].position()},0)},!0)}],restrict:"AE",link:{pre:function(a,d,c){c=a.$eval(c.gridify);a.options=angular.extend({columns:null,responsive:!0,newItemClass:null,containerId:null,firstElementIsStatic:!1},c||{});a.options.firstElementIsStatic&&d.children().eq(0).css("top",0);
a.staticElementNum=0;a.options.firstElementIsStatic&&(a.staticElementNum=1)},post:function(a,d,c,b){function e(c){b.colsNum=a.options.columns||b.calculateCols($(h).width(),a.itemWidth);$(d).css("width",a.itemWidth*b.colsNum);for(var f=0;f<a.gridifiedList.length;f++){var e=f;c?0==e%b.colsNum&&a.gridifiedList[e].position():a.gridifiedList[e].position()}}b.init(d);if(a.options.responsive||a.options.columns)$(window).on("resize",function(){b.calculateCols($(h).width(),a.itemWidth)!=b.colsNum&&e()});var h=
a.options.containerId?$("#"+a.options.containerId):window;a.$on("gridify.re-render",function(a,b){e(b?b.index:null)})}}}}]).directive("gridifyItem",["$rootScope","$timeout","$window",function(g,a,d){return{require:"^gridify",restrict:"AE",link:{pre:function(c,b,e,d){function g(){c.options.newItemClass&&(!k&&d.lastElementRendered)&&f.addClass(c.options.newItemClass);!k&&(d.lastElementRendered&&0==c.staticElementNum&&0==c.$index)&&f.css("top",0);a(function(){var a=c.$index;f.css("left",b.outerWidth(!0)*
((a+c.staticElementNum)%d.colsNum));f.css("top",d.getPrevElementOffset(a+c.staticElementNum));k=!0},0)}var f=$(b);e=c.$eval(e.gridifyItem);var k=!1;d.firstLoaded({width:b.outerWidth(!0),height:b.outerHeight(!0)});e.position=g;g();$(b).on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){c.options.newItemClass&&$(b).removeClass(c.options.newItemClass)})},post:function(c,b,d,h){a(function(){c.$last&&
(h.lastElementRendered=!0,g.$broadcast("gridify.list-loaded"))},20)}}}}])})();
