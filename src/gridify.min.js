(function(){angular.module("jj.gridify",[]).directive("gridify",["$timeout",function(l){return{controller:["$scope",function(a){var d;this.lastElementRendered=!1;this.init=function(a){d=a};this.colsNum=0;a.dimSet=!1;a.itemWidth=0;this.calculateCols=function(a,b){return Math.floor(a/b)};this.getPrevElementOffset=function(a){var b=d.children().eq(a-this.colsNum);return a<this.colsNum?0:parseInt(b[0].style.top.replace("px",""))+b.outerHeight(!0)};this.firstLoaded=function(c){a.dimSet=!0;this.colsNum=
a.options.maxColumns||this.calculateCols(d.width(),c.width);a.itemWidth=c.width;$(d).css("width",a.itemWidth*this.colsNum)}}],restrict:"AE",link:{pre:function(a,d,c){d=a.$eval(c.gridify);a.options=angular.extend({listToWatch:null,maxColumns:null,responsive:!0,newItemClass:null,containerId:null},d||{})},post:function(a,d,c,b){function g(c){b.colsNum=a.options.maxColumns||b.calculateCols($(f).width(),a.itemWidth);$(d).css("width",a.itemWidth*b.colsNum);for(var e=0;e<a.toWatch.length;e++)c?0==e%b.colsNum&&
a.toWatch[e].position():a.toWatch[e].position()}a.toWatch=a.options.listToWatch||alert("Gridify: please choose a variable to watch");b.init(d);if(a.options.responsive)$(window).on("resize",function(){g()});var f=a.options.containerId?$("#"+a.options.containerId):window;a.$on("gridify.re-render",function(a,b){console.log(b);g(b?b.index:null)});a.$watchCollection("toWatch",function(a,b){for(var c=0;c<a.length;c++)a[c].position()})}}}}]).directive("gridifyItem",["$rootScope","$timeout","$window",function(l,
a,d){return{require:"^gridify",restrict:"AE",link:{pre:function(c,b,d,f){function h(){c.options.newItemClass&&(!k&&f.lastElementRendered)&&e.addClass(c.options.newItemClass);a(function(){var a=c.$index;e.css("left",b.outerWidth(!0)*(a%f.colsNum));e.css("top",f.getPrevElementOffset(a));k=!0},0)}var e=$(b);d=c.$eval(d.gridifyItem);var k=!1;console.log("Initializing");f.firstLoaded({width:b.outerWidth(!0),height:b.outerHeight(!0)});d.position=h;h();$(b).on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd webkitAnimationEnd oanimationend msAnimationEnd animationend",
function(){c.options.newItemClass&&$(b).removeClass(c.options.newItemClass)})},post:function(c,b,d,f){a(function(){c.$last&&(f.lastElementRendered=!0)},20)}}}}])})();
